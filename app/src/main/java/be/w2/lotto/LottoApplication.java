/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package be.w2.lotto;

import be.w2.lotto.domain.lottonumber.BonusNumber;
import be.w2.lotto.domain.lottoticket.LottoTickets;
import be.w2.lotto.domain.lottoticket.WinningLottoTicket;
import be.w2.lotto.domain.winningresult.WinningResults;
import be.w2.lotto.dto.InputPurchaseAmountDto;
import be.w2.lotto.dto.LottoTicketsDto;
import be.w2.lotto.dto.WinningResultsDto;
import be.w2.lotto.view.InputView;

import java.util.List;

import static be.w2.lotto.common.util.Parser.parseInputNumbers;
import static be.w2.lotto.view.ErrorView.errorMessage;
import static be.w2.lotto.view.InputView.*;
import static be.w2.lotto.view.OutputView.*;

public class LottoApplication {

    public static void main(String[] args) {
        InputPurchaseAmountDto inputPurchaseAmountDto = LottoApplication.inputPurchaseAmountDto();
        LottoTickets lottoTickets = inputPurchaseAmountDto.lottoTickets;
        int purchaseAmount = inputPurchaseAmountDto.purchaseAmount;
        LottoTicketsDto lottoTicketsDto = LottoTicketsDto.from(lottoTickets);

        outputLottoAmounts(lottoTicketsDto.getLottoTicketAmount());
        outputLottoTickets(lottoTicketsDto.lottoTickets);

        WinningLottoTicket winningLottoTicket = inputWinningNumbers();
        BonusNumber bonusNumber = inputBonusNumber(winningLottoTicket);
        WinningResults winningResult = WinningResults.valueOf(lottoTickets, winningLottoTicket, purchaseAmount, bonusNumber);

        WinningResultsDto winningResultsDto = WinningResultsDto.from(winningResult);
        outputWinningResult(winningResultsDto);
    }

    private static InputPurchaseAmountDto inputPurchaseAmountDto() {
        while (true) {
            try {
                int purchaseAmount = inputPurchaseAmount();
                int manualLottoAmount = inputManualLottoAmount();
                List<List<Integer>> manualLottoNumbers = parseInputNumbers(inputManualLottoNumbers(manualLottoAmount));
                LottoTickets lottoTickets = LottoTickets.valueOf(purchaseAmount, manualLottoNumbers);
                return InputPurchaseAmountDto.of(lottoTickets, purchaseAmount);
            } catch (Exception e) {
                errorMessage(e);
            }
        }
    }

    private static WinningLottoTicket inputWinningNumbers() {
        while (true) {
            try {
                String winningNumbers = InputView.inputWinningNumbers();
                return WinningLottoTicket.valueOf(parseInputNumbers(winningNumbers));
            } catch (Exception e) {
                errorMessage(e);
            }
        }
    }

    private static BonusNumber inputBonusNumber(WinningLottoTicket winningLottoTicket) {
        while (true) {
            try {
                int bonusNumber = inputBonusNumbers();
                return BonusNumber.valueOf(bonusNumber, winningLottoTicket);
            } catch (Exception e) {
                errorMessage(e);
            }
        }
    }
}
